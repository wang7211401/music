"use strict";function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function parseLyric(e){var t=e.split("\n"),a=/^\[(.+)\](.*)$/;t=t.map(function(e,t){var i=e.match(a);if(i)return{time:i[1],words:i[2]}});var i=$(".lines");t.map(function(e){if(e){var t=$("<p/>");t.attr("data-time",e.time).text(e.words),i.append(t)}})}function ininPlayer(e){var t=document.createElement("audio");t.src=e,document.body.appendChild(t),$(".icon-play").on("click",function(){t.play(),$(".top-disc").addClass("active"),$(".top-disc-turn").addClass("active"),$(".top-wrap").removeClass("active")}),$(".icon-pause").on("click",function(){t.pause(),$(".top-disc").removeClass("active"),$(".top-disc-turn").removeClass("active"),$(".top-wrap").addClass("active")}),t.onended=function(){$(".top-disc").removeClass("active"),$(".top-disc-turn").removeClass("active"),$(".top-wrap").addClass("active")},setInterval(function(){for(var e=t.currentTime,a=~~(e/60),i=e-60*a,n=pad(a)+":"+pad(i),r=$(".lines >p"),s=void 0,o=0;o<r.length;o++){var c=r.eq(o).attr("data-time"),p=r.eq(o+1).attr("data-time");0!==r.eq(o+1).length&&c<n&&p>n&&(s=r.eq(o))}if(s){s.addClass("active").prev().removeClass("active");var d=s.offset().top-$(".lines").offset().top-$(".song-lyric").height()/3;$(".lines").css("transform","translateY(-"+d+"px)")}},300)}function pad(e){return e>=10?e+"":"0"+e}var APP_ID="i19UWtaghVE36y85Oo4Uscyx-gzGzoHsz",APP_KEY="J2ge2uYbUiOX1pOAYBILAGon";AV.init({appId:APP_ID,appKey:APP_KEY});var id=getParameterByName("id"),query=new AV.Query("Topsong");query.get(id).then(function(e){var t=e.attributes.url,a=e.attributes.images,i=e.attributes.name,n=e.attributes.singer.split("-")[0],r=e.attributes.lyric,s="<title>"+i+"</title>";$("head").append(s),$(".page").css("background-image","url("+a+")");var o='<img src="'+a+'" alt="">';$(".top-img").append(o);var c="<h3>"+i+" - <span>"+n+"</span></h3>";$(".song-content").prepend(c),ininPlayer(t),parseLyric(r)});