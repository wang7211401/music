"use strict";function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function parseLyric(e){var t=e.split("\n"),a=/^\[(.+)\](.*)$/;t=t.map(function(e,t){var r=e.match(a);if(r)return{time:r[1],words:r[2]}});var r=$(".lines");t.map(function(e){if(e){var t=$("<p/>");t.attr("data-time",e.time).text(e.words),r.append(t)}})}function ininPlayer(e){function t(){c=!1;var e=getComputedStyle(i).transform,t=getComputedStyle(n).transform,a=getComputedStyle(s).transform,r=getComputedStyle(o).transform;n.style.transform="none"===t?e:e.concat(" ",t),o.style.transform="none"===r?a:a.concat(" ",r),$(".top-disc-turn").removeClass("active")}function a(){c=!0,$(".top-disc-turn").addClass("active")}var r=document.createElement("audio");r.src=e,document.body.appendChild(r);var n=document.querySelector(".top-img"),i=n.querySelector("img"),o=document.querySelector(".top-disc-img"),s=o.querySelector(".disc-after"),c=!1;$(".icon-play").on("click",function(){r.play(),c||a(),$(".top-disc").addClass("active"),$(".top-wrap").removeClass("active")}),$(".icon-pause").on("click",function(){r.pause(),c&&t(),$(".top-disc").removeClass("active"),$(".top-wrap").addClass("active")}),r.onended=function(){c&&t(),$(".top-disc").removeClass("active"),$(".top-wrap").addClass("active")},setInterval(function(){for(var e=r.currentTime,t=~~(e/60),a=e-60*t,n=pad(t)+":"+pad(a),i=$(".lines >p"),o=void 0,s=0;s<i.length;s++){var c=i.eq(s).attr("data-time"),p=i.eq(s+1).attr("data-time");0!==i.eq(s+1).length&&c<n&&p>n&&(o=i.eq(s))}if(o){o.addClass("active").prev().removeClass("active");var d=o.offset().top-$(".lines").offset().top-$(".song-lyric").height()/3;$(".lines").css("transform","translateY(-"+d+"px)")}},300)}function pad(e){return e>=10?e+"":"0"+e}var APP_ID="i19UWtaghVE36y85Oo4Uscyx-gzGzoHsz",APP_KEY="J2ge2uYbUiOX1pOAYBILAGon";AV.init({appId:APP_ID,appKey:APP_KEY});var id=getParameterByName("id"),query=new AV.Query("Topsong");query.get(id).then(function(e){var t=e.attributes.url,a=e.attributes.images,r=e.attributes.name,n=e.attributes.singer.split("-")[0],i=e.attributes.lyric,o="<title>"+r+"</title>";$("head").append(o),$(".page").css("background-image","url("+a+")");var s='<img src="'+a+'" alt="">';$(".top-img").append(s);var c="<h3>"+r+" - <span>"+n+"</span></h3>";$(".song-content").prepend(c),ininPlayer(t),parseLyric(i)});